\pretolerance=20000
\tolerance=30000
\setlength{\headheight}{14.61858pt}
\selectlanguage{spanish}
\pagestyle{fancy}

\chapter[Primer cap\'itulo]
{Incluir el t\'itulo completo del primer cap\'itulo}
\label{Chapter01}

\vspace*{1cm}

\begin{center}
  \begin{minipage}{12cm}
    \texttt{
      \baselineskip 10pt
      \begin{flushright}
        Puede introducir una cita \\
        de su elecci\'on. \\
        \sf{Autor de la cita.}
      \end{flushright}
    }
    \textsl{
      \baselineskip 10pt
      Escribir aqu\'i un resumen del primer cap\'itulo en el cual
      se describe el contenido, el objetivo y las principales
      referencias que se utilizaron.
      Se incluye una adecuada justificaci\'on de por qu\'e es necesario
      el desarrollo de este cap\'itulo.
    }
  \end{minipage}
\end{center}

\section{Introducci\'on}
Riemann, Erdos, Selberg, Newman, Tao y otros matem\'aticos han demostrado el
teorema del n\'umero primo de distintas maneras as\'i como Chebyshev y Euler lograron resultados parciales.
Todos aportaron teoremas y t\'ecnicas que han
logrado el desarrollo de nuevas teor\'ias, as\'i como la soluci\'on de conjeturas y propuestas
de hip\'otesis a\'un sin una demostraci\'on.
Adem\'as, desde hace miles de a\~nos Euclides y Erat\'ostenes
como tambi\'en en los \'ultimos cincuenta a\~nos Miller, Rabin, Pollard, Gries y
otros cient\'ificos han podido desarrollar algoritmos eficientes que permiten implementar y conseguir resultados
combinando la Teor\'ia de N\'umeros y las Ciencias de la Computaci\'on,
lo cual tiene un alto impacto en el mundo contempor\'aneo tanto en la teor\'ia como en la pr\'actica,
lo cual se ve reflejado en ramas como la Criptograf\'ia y la Matem\'atica Computacional.
 
\subsection{Nuestros resultados}
El prop\'osito de este trabajo es doble: 
en primer lugar probaremos la f\'ormula de Selberg en todo rigor (ver enunciado a continuaci\'on); 
luego dise√±ar\'emos y analizaremos la eficiencia de estos algoritmos e
implementaremos un programa para su verificaci\'on n\'umerica.
\bigskip

Empezamos enunciado la f\'ormula asint\'otica de Selberg. 
En todo lo que sigue los s\'imbolos $p,q$ se referir\'an a n\'umeros primos positivos.
\bigskip

\noindent {\bf Teorema (La identidad de Selberg)} 
{\it Para todo n\'umero real $x$ mayor o igual a $1$ se cumple la f\'ormula de Selberg}
\[
\sum_{p \leq x} \ln^2(p) + \sum_{pq \leq x} \ln(p) \ln(q) = 2x\ln(x) + O(x).
\]

\subsection{Nuestras t\'ecnicas}
Para obtener nuestros resultados, hemos utilizado herramientas b\'asicas del
an\'alisis real, ejemplos de los cuales tenemos series, sucesiones, continuidad,
l\'imites, derivadas e integrales. 
Asimismo, haremos uso de funciones aritm\'eticas
y estimados de estas, las cuales ser\'an controladas en uso de la notaci\'on {\it big $O$}.
Para el an\'alisis de complejidad asint\'otico de los algoritmos,
haremos uso de la notaci\'on {\it big $O$}, recursividad e invariantes.
El algoritmo principal depender\'a de otros algoritmos que realizar\'an
b\'usquedas binarias y una criba lineal para deteminar los n\'umeros primos en un rango de modo eficiente.
Finalmente, los estimados computacionales ser\'an obtenidos tras realizar una
implementaci\'on de los algoritmos propuestos en el lenguaje GNU C++ 17.

\subsection{Notaci\'on}
Emplearemos $f(x) = O(g(x))$ en vez de $f \in O(g)$
a pesar de que no se trate de una igualdad de conjuntos sino
pertenencia de una funci\'on a una clase de funciones; 
de la misma manera
trataremos la aritm\'etica entre familias de funciones con notaci\'on {\it big $O$}.
Los s\'imbolos $p$ y $q$, en caso de no especificarse,
har\'an referencia a n\'umeros primos positivos.

\subsection{Organizaci\'on}
En la secci\'on 2 presentaremos los teoremas y definiciones que no probaremos pero 
son lugar com\'un en \'area, utilizaremos como referencia \cite{Apostol} y \cite{CLRS}.
En la secci\'on 3 realizaremos la demostraci\'on de la identidad de Selberg tras la prueba de ciertos lemas intermedios.
En la secci\'on 4 propondremos los algoritmos CribaLineal, Buscar\'UltimaPosici\'on y CalcularSuma 
para poder cumplir con el objetivo de realizar estimados con el algoritmo EstimarConstante, el mismo que emplea los tres algoritmos anteriores. 
Todos los algoritmos tendr\'an su respectivo an\'alisis de complejidad asint\'otico.
En la secci\'on 5 implementaremos los algoritmos de la secci\'on anterior en el lenguaje de programaci\'on C++ y
presentaremos tablas con los estimados.

\section{Preliminares matem\'aticos}

En ruta a la identidad de Selberg, tendremos que recordar algunas definiciones y estimados bastante conocidos.

\begin{defn}
Dada una funci\'on $g$ denotamos $O(g(x))$ al conjunto de funciones
\[
\begin{gathered}
O(g(x)) = \{f : \text{existe una constante positiva } c \text{ y un momento } x_0 \text{ tal que}\\
0 \leq f(x) \leq cg(x) \text{ para todo } x \geq x_0\}.
\end{gathered}
\]
\end{defn}

\begin{theorem}[F\'ormula de sumaci\'on de Euler]
Si $f$ tiene una derivada continua $f'$ en el intervalo $[a, b]$ con $0 < a < b$, 
entonces se satisface 
\[
\sum_{a < n \leq x} f(n) = \int_a^b f(t) dt + \int_a^b (t - \floor{t}) f'(t) dt
+ f(a)(\floor{a} - a) - f(b)(\floor{b} - b).
\]
\end{theorem}

\begin{defn}\label{def03}
Sea $f$ y $g$ dos funciones aritm\'eticas, 
definimos su {\bf producto de Dirichlet} como la funci\'on aritm\'etica $h$ definida puntualmente por 
\[
h(n) = \sum_{d \mid n} f(d) g\left(\frac{n}{d}\right).
\]
\end{defn}

\begin{defn}
La funci\'on $\boldsymbol{\mu}$ \textbf{de M\"{o}bius} es definida como sigue. 
Primero definimos 
\[
\mu(1) = 1.
\]
Si $n > 1$, expresamos $n = p_1^{\alpha_1} \cdots p_k^{\alpha_k}$ y 
definimos 
\[
\mu(n) = 
\begin{cases}
(-1)^k &\text{si } \alpha_1 = \cdots = \alpha_k = 1, \\
0 &\text{en otro caso}. 
\end{cases}
\]
\end{defn}

\begin{defn}
Para $n$ entero positivo definimos la funci\'on $\boldsymbol{\Lambda}$ \textbf{de Mangoldt} v\'ia 
\[
\Lambda(n) =
\begin{cases}
\ln p &\text{si } n = p^m \text{ para alg\'un } m \geq 1,\\
0 &\text{en otro caso.}
\end{cases}
\]
\end{defn}

\begin{defn}
Para $x > 0$ definimos la funci\'on $\boldsymbol{\Psi}$ \textbf{de Chebyshev} con la f\'ormula
\[
\Psi(x) = \sum_{n \leq x} \Lambda(n) 
= \sum_{\substack{m = 1\\p^m \leq x}}^\infty \sum_p \Lambda(p^m)
= \sum_{m = 1}^\infty \sum_{p \leq x^{\frac{1}{m}}} \ln p.
\]
\end{defn}

\begin{defn}
Para todo $x > 0$ definimos la funci\'on $\boldsymbol{\vartheta}$ \textbf{de Chebyshev} mediante la ecuaci\'on
\[
\vartheta(x) = \sum_{p \leq x} \ln p.
\]
\end{defn}

\section{Resultados}

\subsection{La Identidad de Selberg}

\begin{lemma}\label{lem08}
Para todo $x \geq 1$ tenemos
\[
\sum_{n \leq x} \frac{1}{n} = \ln x + \gamma + O\left(\frac{1}{x}\right),
\]
aqu\'i $\gamma \approx 0.52$ es una constante conocida como {\bf la constante de Euler}. 
\end{lemma}

\begin{proof}
La funci\'on $f : [1, \infty) \to \BR$ con $f(x)=1/x$ es continua y diferenciable en toda la recta  
conque podemos aplicar la f\'ormula de sumaci\'on de Euler en cualquier intervalo $[2, k]$ 
y as\'i obtener 

\begin{align}
\sum_{n = 2}^k \frac{1}{n} &= \int_1^k \frac{dt}{t} + \int_{1}^k (t - \floor{t})\left(\frac{1}{-t^2}\right) dt \\
&= \ln k - \int_1^k \frac{t - \floor{t}}{t^2} dt,
\end{align} 

lo cual conduce de inmediato a 
\begin{align}
\sum_{n = 1}^k \frac{1}{n} - \ln k = 1 - \int_1^k \frac{t - \floor{t}}{t^2} dt.\label{eq01}
\end{align}

Para analizar qu\'e ocurre cuando $k \to \infty$ escribimos
\begin{align}
\gamma = \lim_{k \to \infty} \left(\sum_{n = 1}^k \frac{1}{n} - \ln k\right) 
= 1- \lim_{k \to \infty}  \left(\int_1^k \frac{t - \floor{t}}{t^2}\right) dt 
=  1- \int_1^\infty \frac{t - \floor{t}}{t^2} dt,
\end{align}

l\'imite que existe, pues al tenerse 
\begin{align}
\int_1^k \frac{t - \floor{t}}{t^2} dt  \le \int_1^k \frac{1}{t^2} dt 
= 1 -\frac{1}{k}   \le 1
\end{align}
la convergencia queda garantizada por monoticidad. 
Al reemplazar $\gamma$ en la f\'ormula desplegada en la Ecuaci\'on \ref{eq01}, llegamos a 
\begin{align}
\sum_{n = 1}^k \frac{1}{n} - \ln k = \gamma + \int_1^\infty \frac{t - \floor{t}}{t^2} dt - \int_1^k \frac{t - \floor{t}}{t^2} dt = 
 \gamma  +  \int_k^\infty \frac{t - \floor{t}}{t^2} dt.
\end{align}

Finalmente, para establecer la f\'ormula anunciada ponemos $k=\floor{x}$ y estimamos 
\begin{align}
\left|\sum_{n \le x} \frac{1}{n} - \ln x  - \gamma \right| &= \left|\sum_{n \le k} \frac{1}{k}  -\ln k -\gamma \right| + |\ln x -\ln k |  \\
& \le \left|   \int_k^\infty \frac{t - \floor{t}}{t^2} dt \right| + \left| \int_k^x  \frac{1}{t}\,dt  \right| \\
& \le \frac{1}{k} + \frac{1}{k} = O\left(\frac{1}{x}\right). 
\end{align}
%utilizar\'e la f\'ormula de sumaci\'on de Euler para $x$ un n\'umero real mayor o igual a 1
%\begin{align*}
%\sum_{n \leq x} \frac{1}{n} &= \int_1^x \frac{1}{t} dt + \int_1^x (t - \floor{t})\left(\frac{1}{-t^2}\right) dt 
%+ (1 - \floor{1}) - (x - \floor{x})\left(\frac{1}{x}\right) \\
%&= (\ln t) \big|_1^x - \int_1^x \frac{t - \floor{t}}{t^2} dt - \frac{x - \floor{x}}{x} \\
%&= \ln x - \int_1^x \frac{t - \floor{t}}{t^2} dt - \frac{x - \floor{x}}{x} \\
%&\leq \ln x - \int_1^x \frac{t - \floor{t}}{t^2} dt + 1 + \frac{x - \floor{x}}{x} \\
%\sum_{n \leq x} \frac{1}{n} &= \ln x - \int_1^x \frac{t - \floor{t}}{t^2} dt + 1 + O\left(\frac{1}{x}\right) \\
%&= \ln x - \int_1^x \frac{t - \floor{t}}{t^2} dt - \int_x^\infty \frac{t - \floor{t}}{t^2} dt 
%+ \int_x^\infty \frac{t - \floor{t}}{t^2} dt + 1 + O\left(\frac{1}{x}\right) \\
%&= \ln x - \int_1^\infty \frac{t - \floor{t}}{t^2} dt + \int_x^\infty \frac{t - \floor{t}}{t^2} dt + 1 + O\left(\frac{1}{x}\right) \\
%&= \ln x + \left(1 - \int_1^\infty \frac{t - \floor{t}}{t^2} dt\right) + \int_x^\infty \frac{t - \floor{t}}{t^2} dt + O\left(\frac{1}{x}\right) \\
%&= \ln x + \gamma + \int_x^\infty \frac{t - \floor{t}}{t^2} dt + O\left(\frac{1}{x}\right) \\
%&\leq \ln x + \gamma + \int_x^\infty \frac{dt}{t^2} + O\left(\frac{1}{x}\right) \\
%&= \ln x + \gamma + \lim_{b \to \infty} \left(-\frac{1}{t}\right) \Big|_x^b + O\left(\frac{1}{x}\right) \\
%&= \ln x + \gamma + \frac{1}{x} + O\left(\frac{1}{x}\right) \\
%&= \ln x + \gamma + O\left(\frac{1}{x}\right)
%\end{align*}
\end{proof}

\begin{lemma}\label{lem09}
Para todo $x \geq 1$ tenemos
\[
\sum_{n \leq x} \ln n = x\ln x - x + O(\ln x).
\]
\end{lemma}

\begin{proof}
Esta vez utilizamos la f\'ormula de sumaci\'on de Euler en $f : [1, \infty) \to \BR$ con $f(x) = \ln x$, continua y diferenciable en toda la recta real positiva:  
\begin{align}
\sum_{n \leq x} \ln x &= \int_1^x \ln t \, dt + \int_1^x  \frac{t - \floor{t}}{t} dt + (\floor{x} - x) \ln x  \\
&= (t \ln t - t) \big|_1^x + \int_1^x \frac{(t - \floor{t})}{t} \, dt + (\floor{x} - x) \ln x \\
&= x \ln x - x + 1 + \int_1^x \frac{t - \floor{t}}{t} dt + (\floor{x} - x) \ln x \\
&\leq x \ln x - x + 1 + \int_1^x \frac{1}{t} \,dt + \ln x \\
&= x \ln x - x + 1 + 2 \ln x.
\end{align}
Como $1$ est\'a dominado por $\ln x$,  
se cumple $\sum_{n \leq x} \ln n = x\ln x - x + O(\ln x)$, 
lo anunciado. 
\end{proof}

\begin{lemma}\label{lem10}
Para toda funci\'on aritm\'etica $f$ se cumple
\[
\sum_{n \leq x} \sum_{d \mid n} f(d) = \sum_{n \leq x} f(n) \floor*{\frac{x}{n}}.
\]
\end{lemma}

\begin{proof}
Sea $f$ y $g$ dos funciones aritm\'eticas, $F$ y $G$ sus respectivas cumulativas;
es decir, $F(x) = \sum_{n \leq x} f(x)$ y $G(x) = \sum_{n \leq x} g(x)$. 
La cumulativa del producto de Dirichlet de $f$ y $g$ est\'a dada por 
\begin{align}
\sum_{n \leq x} f * g (n) &= \sum_{n \leq x} \sum_{cd = n} f(c)g(d)\\
&= \sum_{c \leq x} \sum_{d \leq \frac{x}{c}} f(c) g(d)\\
&= \sum_{c \leq x} f(c) \sum_{d \leq \frac{x}{c}} g(d)\\
&= \sum_{c \leq x} f(c) G\left(\frac{x}{c}\right).\label{eq02}
\end{align}

En particular, cuando $g = \mathbf{1}$, su cumulativa es
\begin{align}
\sum_{n \leq x} \mathbf{1}(n) = \sum_{n \leq x} 1 = \floor{x}.
\end{align}
De este modo, al introducir $G(x)=\floor{x}$ en la Ecuaci\'on \ref{eq02} se logra 
\begin{align}
\sum_{n \leq x} \sum_{d \mid n} f(d) = \sum_{n \leq x} f * \mathbf{1} (n) = \sum_{n \leq x} f(n) \floor*{\frac{x}{n}}, 
\end{align}
lo buscado. 
\end{proof}

\begin{lemma}\label{lem11}
Para todo n\'umero real $x$ tenemos
\[
\floor{x} = x + O(1).
\]
\end{lemma}

\begin{proof}
Sea $x = n + r$ un n\'umero real no negativo, con $n \in \BZ$ y $0 \leq r < 1$. 
De esta manera, por definici\'on de m\'aximo entero tenemos
\begin{align}
\floor{x} &= n \\
&= x - r \\
&= x + O(1).
\end{align}
Concluimos trivialmente la propiedad $\floor{x} = x + O(1)$.
\end{proof}

\begin{lemma}\label{lem12}
Para todo $x \geq 1$ tenemos
\[
\Psi(x) = O(x).
\]
\end{lemma}

\begin{proof}
Usaremos el desarrollo del teorema de Chebyshev por Diamond \cite{Diamond} (ver tambi\'en \cite{Apostol}) 
\begin{align}
A \leq \liminf \frac{\Psi(x)}{x} \leq \limsup \frac{\Psi(x)}{x} \leq \frac{6A}{5}
\end{align}
con $A = -\frac{\ln 1}{1} + \frac{\ln 2}{2} + \frac{\ln 3}{3} + \frac{\ln 5}{5} - \frac{\ln 30}{30} \approx 0.92129202293409078091340844996160...$
Reescribimos la parte derecha de la desigualdad con valor absoluto ya que es una funci\'on positiva cual
\begin{align}
\limsup \frac{|\Psi(x)|}{x} \leq \frac{6A}{5}.
\end{align}
Por definici\'on existe $n_0$ a partir del cual se tiene 
\begin{align}
\frac{|\Psi(x)|}{x} \leq \frac{6A}{5},
\end{align}
es decir, para todo $x > n_0$.
Como ello equivale a
\begin{align}
|\Psi(x)| \leq \left(\frac{6A}{5}\right) x,
\end{align}
se consigue $\Psi(x) = O(x)$.
\end{proof}

\begin{lemma}\label{lem13}
La funci\'on de Mangoldt se puede expresar como el siguiente producto de Dirichlet
$$\Lambda = \mu * \ln.$$
\end{lemma}
\begin{proof}
Esta f\'ormula equivale a  $\Lambda * 1 = \ln$ v\'ia  inversi\'on de M\"obius.  
\end{proof}

\begin{lemma}\label{lem14}
Para todo $x \geq 1$ tenemos
\[
\sum_{n \leq x} \frac{\Lambda(n)}{n} = \ln x + O(1).
\]
\end{lemma}

\begin{proof}
El desarrollo de  $\ln = \Lambda * 1$ cual 
$\ln n = \sum_{d \mid n} \Lambda(d)$ 
lleva a
\begin{align}
\sum_{n \leq x} \ln n = \sum_{n \leq x} \sum_{d \mid n} \Lambda(d).
\end{align}
Una aplicaci\'on directa del \cref{lem10} deriva en 
\begin{align}
\sum_{n \leq x} \ln n = \sum_{n \leq x} \Lambda(n) \floor*{\frac{x}{n}}. 
\end{align}
De ac\'a, en uso del \cref{lem11} conseguimos
\begin{align}
\sum_{n \leq x} \ln n &= \sum_{n \leq x} \Lambda(n) \left(\frac{x}{n} + O(1)\right) \\
&= x \sum_{n \leq x} \frac{\Lambda(n)}{n} + O\left(\sum_{n \leq x} \Lambda(x) \right) \\
&= x \sum_{n \leq x} \frac{\Lambda(n)}{n} + O(\Psi(x)) \\
&= x \sum_{n \leq x} \frac{\Lambda(n)}{n} + O(x)
\end{align}
dado que, por el \cref{lem12}, $\Psi(x) = O(x)$ claramente implica $O(\Psi(x))=O(x)$. 
Si aplicamos el \cref{lem09} al lado izquierdo desembocamos en
\begin{align}
x\ln x - x + O(\ln x) = x \sum_{n \leq x} \frac{\Lambda(n)}{n} + O(x). 
\end{align}
Al despejar obtenemos 
\begin{align}
\sum_{n \leq x} \frac{\Lambda(n)}{n} &= \frac{x \ln x}{x} - 1 + O\left(\frac{\ln x}{x}\right) + O(1) \\
&= \ln x - 1 + O(1) + O\left(\frac{\ln x}{x}\right) \\
%&\leq \ln x - 1 + c_0 + O(1) \\
%&\leq \ln x + c_1 \\
&= \ln x + O(1),
\end{align}
pues $-1 + O(1)+ O(\ln x/x)$ es acotado. 
\end{proof}

\begin{lemma}\label{lem15}
Para $f, g : [1, \infty) \to \BR$ sujetos a  $g(x) = \sum_{n \leq x} f\left(\frac{x}{n}\right) \ln x$ tenemos
\[
\sum_{n \leq x} \mu(n) g\left(\frac{x}{n}\right) = f(x) \ln(x) + \sum_{n \leq x} f\left(\frac{x}{n}\right) \Lambda(n).
\]
\end{lemma}
\begin{proof}
Desarrollemos la sumatoria que queremos analizar
\begin{align}
\sum_{n \leq x} \mu(n) g\left(\frac{x}{n}\right) &= \sum_{n \leq x} \mu(n) \sum_{m \leq x/n} f\left(\frac{x}{nm}\right) \ln \left(\frac{x}{n}\right) \\
&= \sum_{nm \leq x} \mu(n) \ln\left(\frac{x}{n}\right) f \left(\frac{x}{nm}\right) \\    
&= \sum_{c \leq x} f\left(\frac{x}{c}\right) \sum_{d \mid c} \mu(d) \ln\left(\frac{x}{d}\right) \\
&= \sum_{n \leq x} f\left(\frac{x}{n}\right) \sum_{d \mid n} \mu(d) \left[\ln \left(\frac{x}{n}\right) + \ln\left(\frac{n}{d}\right)\right] \\
&= \left[\sum_{n \leq x} f\left(\frac{x}{n}\right) \ln\left(\frac{x}{n}\right) \sum_{d \mid n} \mu(d)\right]
+  \left[\sum_{n \leq x} f\left(\frac{x}{n}\right) \sum_{d \mid n} \mu(d) \ln\left(\frac{n}{d}\right)\right].\\
&= f(x) +  \ln{x} +  \sum_{n \leq x} f\left(\frac{x}{n}\right) (\mu * \ln)(n). 
\end{align}
Con ello, finalmente, 
utilizamos el \cref{lem13} para concluir lo deseado. 
\end{proof}

\begin{lemma}\label{lem16}
Para todo $x \geq 1$ tenemos
\[
\ln^2 x = O(\sqrt{x}).
\]
\end{lemma}

\begin{proof}
Como sabemos que para todo $x \geq 1$ se cumple que $x > \ln x$ (v\'ia an\'alisis de la  derivada de $x - \ln x$), 
se obtiene
\begin{align}
\ln^2 x &= \ln^2 ((x ^ {\frac{1}{4}}) ^ 4) \\
&= 16 \ln^2 (x ^ {\frac{1}{4}}) \\
&< 16 (x ^ {\frac{1}{4}}) ^ 2 \\
&= 16 \sqrt{x}.
\end{align}
\end{proof}

\begin{lemma}\label{lem17}
Para todo $x \geq 1$ tenemos
$$\Psi(x) \ln x + \sum_{n \leq x} \Psi\left(\frac{x}{n}\right)\Lambda(n) = 2x\ln x + O(x).$$
\end{lemma}

\begin{proof}
Para utilizar el \cref{lem15}, definimos convenientemente $f : [1, \infty) \to \BR$ con
\begin{align}
f(x) = \Psi(x) - x + \gamma + 1.
\end{align}
Antes de aplicar el \cref{lem15}, le brindaremos a $g(x) = \sum_{n \leq x} f\left(\frac{x}{n}\right)\ln x$ 
una expansi\'on diferente cual es 
\begin{align}
g(x)= \sum_{n \leq x} f\left(\frac{x}{n}\right)\ln x &= \sum_{n \leq x} \left(\Psi\left(\frac{x}{n}\right) - \frac{x}{n} + \gamma + 1\right) \ln x \\
&= \sum_{n \leq x} \Psi\left(\frac{x}{n}\right) \ln x - x \ln x \sum_{n \leq x} \frac{1}{n} + (\gamma + 1) \ln x \sum_{n \leq x} 1.\label{eq50}
\end{align}
Analicemos por separado cada sumatoria de la Ecuaci\'on \ref{eq50}.

La primera resulta ser 
\begin{align}
\sum_{n \leq x} \Psi\left(\frac{x}{n}\right) = \sum_{n \leq x} \sum_{d \leq \frac{x}{n}} \Lambda(d) = 
 \sum_{n \leq x} \sum_{d \mid n} \Lambda(d) = 
 \sum_{n \leq x} (\Lambda * 1)(n) = 
\sum_{n \leq x} \ln n, 
\end{align}
de tipo $x\ln x - x + O(\ln x)$ por el \cref{lem09}.
Al multiplicar el logaritmo obtenemos la expresi\'on
\begin{align}
\sum_{n \leq x} \Psi\left(\frac{x}{n}\right)\ln x = x \ln^2 x - x \ln x + O(\ln^2 x).
\end{align}

Para la segunda recurrimos al \cref{lem08} y logramos 
\begin{align}
-x \ln x \sum_{n \leq x} \frac{1}{n} &= -x \ln x \left(\ln x + \gamma + O\left(\frac{1}{x}\right)\right) \\
&= -x \ln^2 x - \gamma x \ln x + O(\ln x).
\end{align}

Para la tercera necesitamos el \cref{lem11}: 
\begin{align}
(\gamma + 1) \ln x \sum_{n \leq x} 1 &= (\gamma + 1) \ln x \floor{x} \\
&= (\gamma + 1) \ln x (x + O(1)) \\
&= (\gamma + 1) x \ln x + O(\ln x).
\end{align}

Finalmente, juntamos los tres resultados y obtenemos
\begin{align}
g(x) &= x \ln^2 x - x \ln x + O(\ln^2 x) - x \ln^2 x - \gamma x \ln x + O(\ln x) + (\gamma + 1) x \ln x + O(\ln x) \\
&= O(\ln^2 x) + O(\ln x) \\
&= O(\ln^2 x). 
\end{align}

Del \cref{lem15} obtenemos entonces 
\begin{align}
\sum_{n \leq x} \mu(n) g\left(\frac{x}{n}\right) = 
(\Psi(x) - x + \gamma + 1) \ln x + \sum_{n \leq x} \left(\Psi\left(\frac{x}{n}\right) - \frac{x}{n} + \gamma + 1\right) \Lambda(n). 
\end{align}
El remate consiste en analizar ambos miembros de la desigualdad por separado. 

Utilizamos la desigualdad triangular el hecho de que se cumple $g(x) = O(\ln^2 x)$ para obtener a la izquierda 
\begin{align}
\left | \sum_{n \leq x} \mu(n) g\left(\frac{x}{n}\right) \right|  \leq \sum_{n \leq x} \left| g\left(\frac{x}{n}\right) \right| 
= O\left(\sum_{n \leq x} g\left(\frac{x}{n}\right)\right) 
= O\left(\sum_{n \leq x} \ln^2 \left(\frac{x}{n}\right)\right).
\end{align}
Con esta expresi\'on el \cref{lem16} permite conseguir
\begin{align}
\sum_{n \leq x} \mu(n) g\left(\frac{x}{n}\right) = O\left(\sum_{n \leq x} \sqrt{\frac{x}{n}}\right) 
= O\left(\sqrt{x} \sum_{n \leq x} \frac{1}{\sqrt{n}}\right) = O\left( \sqrt{x}\cdot \sqrt{x}\right)=O(x). 
\end{align}

El t\'ermino de la derecha lo reordenamos cual 
\begin{align}
 \Psi(x)\ln x + \sum_{n \leq x} \Psi\left(\frac{x}{n}\right)\Lambda(n) - x \ln x - x \sum_{n \leq x} \frac{\Lambda(n)}{n} + (\gamma + 1)\Psi(x).\label{eq64}
\end{align}
Merced a \cref{lem12} y \cref{lem14} reducimos la Expresi\'on \ref{eq64}
\begin{align}
& \hskip -0.5in  \Psi(x)\ln x + \sum_{n \leq x} \Psi\left(\frac{x}{n}\right)\Lambda(n) - x \ln x - x(\ln x + O(1)) + O(x)\\
&= \Psi(x)\ln x + \sum_{n \leq x} \Psi\left(\frac{x}{n}\right)\Lambda(n) - 2x \ln x + O(x).
\end{align}
Finalmente, igualamos los resultados de ambas partes
\begin{align}
\Psi(x)\ln x + \sum_{n \leq x} \Psi\left(\frac{x}{n}\right)\Lambda(n) - 2x \ln x + O(x) = O(x), 
\end{align}
equivalente a lo aseverado. 
\end{proof}

\begin{lemma}\label{lem18}
Para todo $x \geq 1$ tenemos
\[
\Psi(x) = \vartheta(x) + O(\sqrt{x}\ln x).
\]
\end{lemma}

\begin{proof}
Directo de la definici\'on observamos que se cumple 
\begin{align}
\Psi(x) = \sum_{n = 1}^\infty \vartheta(x^\frac{1}{n}).
\end{align}
Notemos que al mismo tiempo esta sumatoria tiene apenas una cantidad finita de t\'erminos efectivos puesto que la funci\'on $\vartheta$ 
solo tiene sentido cuando es evaluada en valores mayores o iguales a $2$. 
Para un $x$ espec\'ifico,  hallamos ese momento $m=m(x)$ mediante la cadena 
\begin{align}
x^\frac{1}{m} &\geq 2 \\
x^\frac{2}{m} &\geq 4 \\
x^\frac{2}{m} &> e \\
\frac{2}{m}\ln x &> \ln e \\
\frac{2}{m}\ln x &> 1 \\
m &< 2 \ln x
\end{align}
y notamos que para valores mayores $m = \floor{2 \ln x}$ los constituyentes de la suma son nulos.
Ahora podemos escribir a $\Psi$ como 
\begin{align}
\Psi(x) &= \vartheta(x) + \vartheta(x^\frac{1}{2}) + \cdots + \vartheta(x^\frac{1}{m}) \\
\Psi(x) &= \vartheta(x) + \sum_{n = 2}^m \vartheta(x^\frac{1}{n}).
\end{align}

Para el an\'alisis de $\sum_{n = 2}^m \vartheta(x^\frac{1}{n})$ desdoblamos 
\begin{align}
\sum_{n = 2}^m \vartheta(x^\frac{1}{n}) = \sum_{n = 2}^m \sum_{p \leq x^\frac{1}{n}} \ln p. 
\end{align}
Trataremos de darle forma manipulativa sencilla. 
Si un n\'umero primo $p$ ser\'a inmiscuido en la sumatoria, 
su logaritmo contribuir\'a a la sumatoria tantas veces como las ra\'ices de $x$ lo permitan: 
entre $1$ y $k$, donde $k$ es el m\'aximo entero que obedece $p^k \le x$.  
F\'acilmente hallamos que este m\'aximo est\'a dado por 
\begin{align}
k = \floor*{\frac{\ln x}{\ln p}}.
\end{align}

Por su parte, para forzar por lo menos $p^2 \le x$, se necesita $p \le \sqrt{x}$,
detalle importante que aprovecharemos.

Ahora analicemos la forma equivalente de la doble sumatoria
\begin{align}
\sum_{n = 2}^m \sum_{p^n \leq x} \ln p &= \sum_{p \leq \sqrt{x}} \, \, \sum_{2 \leq n \leq \floor*{\frac{\ln x}{\ln p}}} \ln p \\
&= \sum_{p \leq \sqrt{x}} \ln p \sum_{2 \leq n \leq \floor*{\frac{\ln x}{\ln p}}} 1 \\
&\leq \sum_{p \leq \sqrt{x}} \ln p \floor*{\frac{\ln x}{\ln p}} \\
&\leq \sum_{p \leq \sqrt{x}} \ln p \left(\frac{\ln x}{\ln p}\right) \\
&= \sum_{p \leq \sqrt{x}} \ln x \\
&= \ln x \sum_{p \leq \sqrt{x}} 1 \\
&\leq \ln x \sum_{n \leq \sqrt{x}} 1 \\
&\leq \ln x \sqrt{x}, 
\end{align}
lo que permite concluir $\sum_{n = 2}^m \vartheta(x^\frac{1}{n}) = O(\sqrt{x} \ln x)$. 

Con lo anterior queda establecida la relaci\'on $\Psi(x) = \vartheta(x) + O(\sqrt{x} \ln x)$.
\end{proof}

\begin{lemma}\label{lem19}
La serie
\[
\sum_{p = 2}^{\infty} \frac{\ln p}{p (p - 1)}
\]
tomada sobre los primos converge.
\end{lemma}

\begin{proof}
El primer paso es notar que el l\'imite
\begin{align}
\lim_{n \to \infty} \frac{\ln n}{n (n - 1)} n^\frac{3}{2}
\end{align}
vale $0$ como se deduce al descomponer 
\begin{align}
\frac{\ln n}{n (n - 1)} n^\frac{3}{2} = \left(\frac{\ln n}{\sqrt{n}}\right)\left(\frac{n}{n - 1}\right).
\end{align}

Analicemos el l\'imite de lo que est\'a dentro del par\'entesis de la izquierda
\begin{align}
\lim_{n \to \infty} \frac{\ln n}{\sqrt{n}} = \frac{\infty}{\infty}.
\end{align}
Como este es de la forma $\frac{\infty}{\infty}$, aplicamos la regla de L'Hospital
\begin{align}
\lim_{n \to \infty} \frac{\ln n}{\sqrt{n}}
= \lim_{n \to \infty}\frac{\frac{1}{n}}{\frac{1}{2\sqrt{n}}}
= \lim_{n \to \infty} \frac{2}{\sqrt{n}} = 0.
\end{align}

Ahora analicemos el l\'imite de lo que est\'a dentro del par\'entesis de la derecha
\begin{align}
\lim_{n \to \infty} \frac{n}{n - 1}
= \lim_{n \to \infty} \frac{1}{1 - \frac{1}{n}}
= \frac{1}{1 - 0} = 1.
\end{align}

Como ambos l\'imites existen, por aritm\'etica de l\'imites obtenemos
\begin{align}
\lim_{n \to \infty} \frac{\ln n}{n (n - 1)} n^\frac{3}{2}
= \left(\lim_{n \to \infty} \frac{\ln n}{\sqrt{n}}\right)\left(\lim_{n \to \infty} \frac{n}{n - 1}\right)
= 0 \cdot 1 = 0.
\end{align}

Por supuesto, lo mismo es v\'alido si crecemos a lo largo de primos, conque se tiene 
\begin{align}
\lim_{p \to \infty} \frac{\ln p}{p (p - 1)} p^\frac{3}{2}=0.
\end{align}

Por definici\'on entonces, dado $\epsilon > 0$, existe un $n_0$ 
a partir del cual se tiene 
\begin{align}
\frac{\ln p}{p (p - 1)} p^\frac{3}{2} < \epsilon
\end{align}

De este modo, al hacer $n_1 = \floor{n_0} + 1$, sabemos que para todo $p \geq n_1$ se tendr\'a 
\begin{align}
\sum_{p \geq n_1} \frac{\ln p}{p (p - 1)} <  \sum_{p \geq n_1} \frac{\epsilon}{p^\frac{3}{2}}. 
\end{align}

Como el menor primo es 2, logramos el estimado 
\begin{align}
\sum_{p \geq n_1} \frac{\ln p}{p (p - 1)} <  \sum_{p \geq n_1} \frac{\epsilon}{p^\frac{3}{2}} \le \int_{1}^\infty \frac{\epsilon}{x^\frac{3}{2}} dx  < 2 \epsilon. 
\end{align}

Esto, por supuesto, lleva a 
\begin{align}
\sum_{p = 2}^\infty \frac{\ln p}{p (p - 1)} < \sum_{p < n_1} \frac{\ln p}{p (p - 1)} + 2 \epsilon, 
\end{align}
lo que equivale a la convergencia absoluta de la serie. 
\end{proof}

\begin{lemma}\label{lem20}
Para todo $x \geq 1$ tenemos
\[
\vartheta(x)\ln x + \sum_{p \leq x} \vartheta\left(\frac{x}{p}\right)\ln p = 2x\ln x + O(x).
\]
\end{lemma}

\begin{proof}
El primer paso es comparar la sumatoria con otra m\'as a tono con nuestros intereses: 
\begin{align}
\sum_{n \leq x} \Psi\left(\frac{x}{n}\right)\Lambda(n) - \sum_{p \leq x} \vartheta\left(\frac{x}{p}\right)\ln p
&= \sum_{n \leq x} \sum_{m \leq \frac{x}{n}} \Lambda(m)\Lambda(n) - \sum_{p \leq x} \sum_{q \leq \frac{x}{p}} \ln q \ln p \\
&= \sum_{nm \leq x} \Lambda(n)\Lambda(m) - \sum_{pq \leq x} \ln p \ln q.
\end{align}
En el primero de los dos sumandos sobrevivientes, la funci\'on de Mangoldt solo act\'ua sobre las potencias de los primos. 
En particular, todas las combinaciones de primos con potencias iguales a uno van de la mano con la sumatoria que estamos restando a la derecha.
De esta manera, apenas sobreviven aquellos t\'erminos 
con al menos uno de los exponentes mayor o igual a dos. 
De este modo, se consigue 
\begin{align}
\sum_{n \leq x} \Psi\left(\frac{x}{n}\right)\Lambda(n) - \sum_{p \leq x} \vartheta\left(\frac{x}{p}\right)\ln p & \le 
\sum_{\substack{p^n q^m \leq x \\ n \geq 2, m \geq 1}} \ln p \ln q  + 
\sum_{\substack{p^n q^m \leq x \\ m \geq 2, n \geq 1}} \ln p \ln q \\
& = 2 \sum_{\substack{p^n q^m \leq x \\ n \geq 2, m \geq 1}} \ln p \ln q \\
& = 2 \sum_{\substack{p^n \leq x \\ n \geq 2}} \ln p \sum_{\substack{q^m \leq \frac{x}{p^n} \\ m \geq 1}} \ln q  \\
& = O\left(\sum_{\substack{p^n \leq x \\ n \geq 2}} \ln p \, \Psi\left(\frac{x}{p^n}\right)\right), 
\end{align}
puesto que tras desigualdad contamos por partida doble aquellos pares con ambos exponentes al menos dos y ello contribuyen con valores positivos. 
%Debido a que los primos deben tomarse por pares,
%podemos asegurarnos de este exponente en el primer n\'umero primo y que el exponente del segundo n\'umero primo tome cualquier valor
%\begin{align*}
%\sum_{n \leq x} \Psi\left(\frac{x}{n}\right)\Lambda(n) - \sum_{p \leq x} \vartheta\left(\frac{x}{p}\right)\ln p
%&= O\left(\sum_{\substack{p^n q^m \leq x \\ n \geq 2, m \geq 1}} \ln p \ln q\right) \\
%&= O\left(\sum_{\substack{p^n \leq x \\ n \geq 2}} \ln p \sum_{\substack{q^m \leq \frac{x}{p^n} \\ m \geq 1}} \ln q\right) \\
%&= O\left(\sum_{\substack{p^n \leq x \\ n \geq 2}} \ln p \, \Psi\left(\frac{x}{p^n}\right)\right).
%\end{align*}
Para continuar, utilizamos el \cref{lem12} en la \'ultima igualdad y logramos 
\begin{align}
\sum_{n \leq x} \Psi\left(\frac{x}{n}\right)\Lambda(n) - \sum_{p \leq x} \vartheta\left(\frac{x}{p}\right)\ln p
&= O\left(\sum_{\substack{p^n \leq x \\ n \geq 2}} \ln p \, \frac{x}{p^n}\right) \\
&= O\left(x\sum_{\substack{p^n \leq x \\ n \geq 2}} \frac{\ln p}{p^n}\right).
\end{align}

Llegado este punto, nuevamente notamos que la contribuci\'on en la cola es exclusiva de los primos sujetos a $p^2 \le x$. 
Asimismo, los t\'erminos de la sumatoria est\'an dominados por una serie geom\'etrica, 
por lo que conseguimos 
\begin{align}
\sum_{n \leq x} \Psi\left(\frac{x}{n}\right)\Lambda(n) - \sum_{p \leq x} \vartheta\left(\frac{x}{p}\right)\ln p
&= O\left(x \sum_{p \leq \sqrt{x}} \ln p \sum_{n \geq 2} \frac{1}{p^n}\right) \\
%
%\sum_{n \leq x} \Psi\left(\frac{x}{n}\right)\Lambda(n) - \sum_{p \leq x} \vartheta\left(\frac{x}{p}\right)\ln p
&= O\left(x \sum_{p \leq \sqrt{x}} \ln p \sum_{m \geq 0} \frac{1}{p^{m + 2}}\right) \\
&= O\left(x \sum_{p \leq \sqrt{x}} \frac{\ln p}{p^2} \sum_{m \geq 0} \frac{1}{p^m}\right) \\
&= O\left(x \sum_{p \leq \sqrt{x}} \frac{\ln p}{p^2} \left(\frac{1}{1 - \frac{1}{p}}\right)\right) \\
&= O\left(x \sum_{p \leq \sqrt{x}} \frac{\ln p}{p^2} \left(\frac{p}{p - 1}\right)\right) \\
&= O\left(x \sum_{p \leq \sqrt{x}} \frac{\ln p}{p (p - 1)}\right).
\end{align}
Como seg\'un el \cref{lem19} la serie $\displaystyle{\sum_{p = 2}^{\infty} \frac{\ln p}{p (p - 1)}}$ coverge, 
las sumas parciales est\'an acotadas, y reducimos a 
\begin{align}
\sum_{n \leq x} \Psi\left(\frac{x}{n}\right)\Lambda(n) - \sum_{p \leq x} \vartheta\left(\frac{x}{p}\right)\ln p
&= O\left(x \sum_{p = 2}^\infty \frac{\ln p}{p (p - 1)}\right) \\
&= O(x).
\end{align}

Al inmiscuir al \cref{lem17}, esta relaci\'on se troca por 
\begin{align}
2x\ln x + O(x) - \Psi(x)\ln x - \sum_{p \leq x} \vartheta\left(\frac{x}{p}\right)\ln p = O(x), 
\end{align}
o lo que es lo mismo por 
\begin{align}
\Psi(x)\ln x + \sum_{p \leq x} \vartheta\left(\frac{x}{p}\right)\ln p = 2x\ln x + O(x).
\end{align}
De ac\'a, el uso consecutivo del \cref{lem18} (para $\Psi$) y el \cref{lem16} (para $\ln^2 x$) deviene en la secuencia
\begin{align}
(\vartheta(x) + O(\sqrt{x}\ln x))\ln x + \sum_{p \leq x} \vartheta\left(\frac{x}{p}\right)\ln p &= 2x\ln x + O(x), \\
\vartheta(x)\ln x + O(\sqrt{x}\ln^2 x) + \sum_{p \leq x} \vartheta\left(\frac{x}{p}\right)\ln p &= 2x\ln x + O(x), \\
\vartheta(x)\ln x + O(\sqrt{x}\sqrt{x}) + \sum_{p \leq x} \vartheta\left(\frac{x}{p}\right)\ln p &= 2x\ln x + O(x), \\
\vartheta(x)\ln x + O(x) + \sum_{p \leq x} \vartheta\left(\frac{x}{p}\right)\ln p &= 2x\ln x + O(x).
\end{align}
%Concluimos que se cumple $\vartheta(x)\ln x + \sum_{p \leq x} \vartheta\left(\frac{x}{p}\right)\ln p = 2x\ln x + O(x)$ para todo $x \geq 1$.
\end{proof}

\begin{lemma}
La serie
\[
\sum_{n = 1}^\infty \frac{1}{n ^ 2}
\]
converge a un n\'umero menor o igual a $2$. 
\end{lemma}

\begin{proof}
Esto es sencillo si utilizamos sumas telesc\'opicas: 
\begin{align}
\sum_{n = 1}^k \frac{1}{n^2} &= 1 + \sum_{n = 2}^k \frac{1}{n^2} \\
&\leq 1 + \sum_{n = 2}^k \frac{1}{n (n - 1)} \\
&= 1 + \sum_{n = 2}^k \left(\frac{1}{n - 1} - \frac{1}{n}\right) \\
&= 1 + \left(\frac{1}{2 - 1} - \frac{1}{k}\right) \\
&= 2 - \frac{1}{k}.
\end{align}
El resultado se sigue de inmediato. 
\end{proof}

Finalmente el resultado te\'orico m\'as importante de esta recopilaci\'on. 

\begin{theorem}[F\'ormula asint\'otica de Selberg]\label{the22}
Para todo $x \geq 1$ tenemos
\[
\sum_{p \leq x} \ln^2 p + \sum_{pq \leq x} \ln p \ln q = 2x\ln x + O(x).
\]
\end{theorem}

\begin{note}
En la f\'ormula dada arriba es indistinto si toman $p,q$ distintos o si se permite que sean iguales. 
En efecto, la diferencia entre una y otra alternativa es apenas  
\[
\sum_{p^2 \le x} (\ln p)^2 \le \sum_{p^2 \le x} (\ln x^{1/2})^2 \le \frac{\sqrt{x} \ln^2 x}{4}= O(x).  
\]
\end{note}

\begin{proof}[Prueba de la f\'ormula de Selberg]
Consolidemos la diferencia en una \'unica suma 
\begin{align}
\vartheta(x)\ln x - \sum_{p \leq x} \ln^2 p &= \sum_{p \leq x} \ln p \ln x - \sum_{p \leq x} \ln p \ln p \\
&= \sum_{p \leq x} \ln p (\ln x - \ln p) \\
&= \sum_{p \leq x} \ln p \ln \left(\frac{x}{p}\right).\label{eq127}
\end{align}

A continuaci\'on recurrimos a una versi\'on gruesa del \cref{lem08}:
Al ser $\dfrac{1}{x}$ acotado para $x \ge 0$, obtenemos  para la serie arm\'onica 
\begin{align}
\sum_{n \leq x} \frac{1}{n} &= \ln x + \gamma + O\left(\frac{1}{x}\right) \\
&= \ln x + O(1),  
\end{align}
o, lo que es lo mismo, 
\begin{align}
\ln x = \sum_{n \leq x} \frac{1}{n} + O(1). 
\end{align}

Reeplazamos este nuevo estimado en la Ecuaci\'on \ref{eq127} para conseguir 
\begin{align}
\vartheta(x)\ln x - \sum_{p \leq x} \ln^2 p &= \sum_{p \leq x} \ln p \ln \left(\frac{x}{p}\right) \\
&= \sum_{p \leq x} \ln p \left(\sum_{n \leq \frac{x}{p}} \frac{1}{n} + O(1)\right) \\
&= \sum_{p \leq x} \ln p \sum_{n \leq \frac{x}{p}} \frac{1}{n} + O\left(\sum_{p \leq x} \ln p\right) \\
&= \sum_{p \leq x} \sum_{n \leq \frac{x}{p}} \frac{\ln p}{n} + O\left(\sum_{p \leq x} \ln p\right) \\
&= \sum_{n \leq x} \sum_{p \leq \frac{x}{n}} \frac{\ln p}{n} + O\left(\sum_{p \leq x} \ln p\right) \\
&= \sum_{n \leq x} \sum_{p \leq \frac{x}{n}} \frac{\ln p}{n} + O(\vartheta(x)).\label{eq136}
\end{align}
Pero una combinaci\'on de \cref{lem12} y \cref{lem18} conduce a 
\begin{align}
\Psi(x) &= O(x),  \\
\vartheta(x) &= O(x),
\end{align}
propiedad que utilizaremos en la forma $O(\vartheta(x))=O(x)$.

A continuaci\'on desdoblamos uno de los sumandos en Ecuaci\'on \ref{eq136} para llegar a 
\begin{align}
\vartheta(x)\ln x - \sum_{p \leq x} \ln^2 p &= \sum_{n \leq x} \sum_{p \leq \frac{x}{n}} \frac{\ln p}{n} + O(x) \\
&= \sum_{n \leq x} \frac{1}{n}\sum_{p \leq \frac{x}{n}} \ln p + O(x) \\
&= \sum_{n \leq x} \frac{1}{n}\cdot \vartheta\left(\frac{x}{n}\right) + O(x) \\
%&= \sum_{n \leq x} \frac{O\left(\frac{x}{n}\right)}{n} + O(x) \\
&= O\left(x \sum_{n \leq x} \frac{1}{n^2}\right) + O(x) \\
&= O(2x)+O(x)=O(x), 
\end{align}
pues la sumatoria de rec\'iprocos al cuadrado est\'a acotada por $2$. 

Para el remate es cuesti\'on de reemplazar en el \cref{lem20} y lograr  
\begin{align}
2x\ln x + O(x) &= \vartheta(x)\ln x + \sum_{p \leq x} \vartheta\left(\frac{x}{p}\right)\ln p  \\
&= \sum_{p \leq x} \ln^2 p + O(x) + \sum_{p \leq x} \vartheta\left(\frac{x}{p}\right)\ln p  \\
&= \sum_{p \leq x} \ln^2 p + \sum_{p \leq x} \sum_{q \leq \frac{x}{p}} \ln q \ln p  \\
&= \sum_{p \leq x} \ln^2 p + \sum_{pq \leq x} \ln p \ln q, 
\end{align}
la f\'ormula de Selberg.
\end{proof}

\subsection{Algoritmo Principal}
Adicional a la prueba del Teorema \ref{the22}, he dise\~nado unos algoritmos para poder obtener estimados
con la f\'ormula asint\'otica de Selberg. Primero, realicemos ciertas manipulaciones a la f\'ormula demostrada
\begin{gather}
\sum_{p \leq x} \ln^2 p + \sum_{pq \leq x} \ln p \ln q = 2x\ln x + O(x) \\
\sum_{p \leq x} \ln^2 p + \sum_{pq \leq x} \ln p \ln q - 2x\ln x = O(x) \\
\frac{\sum_{p \leq x} \ln^2 p + \sum_{pq \leq x} \ln p \ln q - 2x\ln x}{x} = O(1).
\end{gather}

Por definici\'on, esto significa que existe un momento $n_0 > 0$ y una constante $c > 0$ a partir del cual
\begin{align}
\left|\frac{\sum_{p \leq x} \ln^2 p + \sum_{pq \leq x} \ln p \ln q - 2x\ln x}{x}\right| \leq c
\end{align}
para todo $x \geq n_0$.

Asumamos que tenemos un n\'umero $x$ y queremos calcular
\begin{align}
\left|\frac{\sum_{p \leq x} \ln^2 p + \sum_{pq \leq x} \ln p \ln q - 2x\ln x}{x}\right|.
\end{align}

La estrategia que utilizaremos consiste en lo siguiente:
Primero precalcularemos los n\'umeros primos en el rango $[1 \dots x]$.
Como solamente manipularemos logaritmos de n\'umeros primos, aprovechar\'e de esto para poder precalcular
las sumatorias y hallar sumas en rangos en $O(1)$ como diferencia de sumas.
El contenedor $\log$ almacenar\'a lo siguiente:
\[
\log[p] =
\begin{cases}
\ln p &\quad\text{si }$p$\text{ es primo,}\\
0 &\quad\text{en otro caso.}
\end{cases}
\]

As\'i, $\sum_{i = l}^r \log[i]$ solo tendr\'a la sumatoria de
los logaritmos naturales de los n\'umeros primos en el intervalo $[l, r]$.

El contenedor es\_primo almacenar\'a lo siguiente:
\[
\text{es\_primo[$p$]} =
\begin{cases}
\text{verdadero} &\quad\text{si }$p$\text{ es primo,}\\
\text{falso} &\quad\text{en otro caso.}
\end{cases}
\]

Los contenedores suma\_$\log$ y suma\_$\log^2$ almacenar\'an
\[
\text{suma\_$\log$[$x$]} = \sum_{i = 0}^x \log[i]
\]
y
\[
\text{suma\_$\log^2$[$x$]} = \sum_{i = 0}^x \log^2[i].
\]

El primer preprocesamiento que realizaremos ser\'a llamar al m\'etodo CribaLineal.
Este m\'etodo reibir\'a como par\'ametro al n\'umero n. 

\begin{algorithm}[H]
\SetAlgoLined
\DontPrintSemicolon
\KwData{es\_primo, primos, $n$.}
\KwResult{N\'umeros primos en el rango $[1 \dots n]$ guardados en primos.}
\Begin{
    es\_primo[$0$] $\leftarrow$ falso\;
    es\_primo[$1$] $\leftarrow$ falso\;
    \For{$i \leftarrow 2$ \KwTo $n$} {
        es\_primo[$i$] $\leftarrow$ verdadero\;
    }
    primos $\leftarrow$ $\emptyset$\;
    \For{$i \leftarrow 2$ \KwTo $n$} {
        \If{es\_primo[$i$]} {
            primos $\leftarrow$ primos $\cup\;\{i\}$\;
        }
        \For{$p \in$ primos \textbf{and} $i \cdot p \leq n$}{
            es\_primo[$i \cdot p$] $\leftarrow$ falso\;
            \If{$i \equiv 0 \mod{p}$}{
                \textbf{break}\;
            }
        }
    }
}
\caption{CribaLineal\label{CL}}
\end{algorithm}

\begin{lemma}
Sea $n$ el n\'umero que representa el extremo derecho del intervalo $[1 \dots n]$
en el cual queremos hallar todos los n\'umeros primos mediante la ejecuci\'on de CribaLineal. Luego el tiempo de ejecuci\'on es $O(n)$.
\end{lemma}

\begin{proof}
\end{proof}

\begin{algorithm}[H]
\SetAlgoLined
\DontPrintSemicolon
\KwData{$i, x,$ primos}
\KwResult{Posici\'on del mayor n\'umero primo $q$ tal que $pq \leq x$.
En caso no exista, se retornar\'a $-1$.}
\Begin{
    $p \leftarrow$ primos[$i$]\;
    $l \leftarrow i$\;
    $r \leftarrow |$primos$| - 1$\;
    \If{$p \cdot primos[r] \leq x$}{
        \textbf{return} r\;
    }
    \If{$p^2 > x$}{
        \textbf{return} $-1$\;
    }
    \While{$r - l > 1$}{
        $m \leftarrow \floor*{\frac{l + r}{2}}$\;
        \eIf{$p \cdot primos[m] \leq x$} {
            $l \leftarrow m$\;
        } {
            $r \leftarrow m$\;
        }
    }
    \textbf{return} $l$\;
}
\caption{Buscar\'UltimaPosici\'on\label{BUP}}
\end{algorithm}

\begin{lemma}
Sea $i$ el \'indice que representa al $i$-\'esimo n\'umero primo
y $p$ este $i$-\'esimo n\'umero primo.
Sea $x$ el n\'umero que representa la cota superior para el producto de $p$ con otro n\'umero primo $q$ tal que $pq \leq x$ y $q \geq p$.
Obtendremos la posici\'on del mayor n\'umero primo $q$ que cumpla con lo anterior o
$-1$ en caso este n\'umero primo no exista
mediante la ejecuci\'on de Buscar\'UltimaPosici\'on.
Luego el tiempo de ejecuci\'on es $O(\log_2 n)$.
\end{lemma}

\begin{proof}
Obtener el valor del $i$-\'esimo n\'umero primo e inicializar
nuestros extremos de los intervalos para realizar la b\'usqueda binaria en las l\'ineas
$2 - 4$ toma $O(1)$ en tiempo.
Nuestro objetivo es encontrar la \'ultima posici\'on $j$ en la cual
el $j$-\'esimo n\'umero primo multiplicado por $p$ sea menor o igual a $x$ con $i \leq j$. Antes de analizar la invariante, quit\'emonos de encima los casos borde.
El primer caso borde es en el cual el menor elemento en nuestro rango no cumple la condici\'on,
en este caso retornamos $-1$, pues para todo $q > p$ tenemos que $pq > p^2 > x$,
por lo que no existir\'a par que satisfaga la condici\'on.
El segundo caso borde es cuando el n\'umero de la \'ultima posici\'on cumple.
En este caso retornamos de inmediato esta \'ultima posici\'on,
pues para cualquier $q < p_r$ tenemos $pq < p \cdot p_r \leq x$,
por lo cual todos los dem\'as primos en el rango tambi\'en cumplir\'ian.
Analizar ambos casos nos tomar\'ia $O(1)$ en tiempo.
Al entrar al bucle en las l\'ineas $11 - 18$ se satisface $i = l < r = \pi(x) - 1$ y adem\'as
$p\;\cdot$ primos[$l$] $\leq x$ y $p\;\cdot$ primos[$r$] $> x$.
Mientras que $l$ y $r$ disten al menos 2, computaremos $m = \floor*{\frac{l + r}{2}}$
y podemos distinguir dos casos:
el primer caso es cuando se cumple $p\;\cdot$ primos[$m$] $\leq x$, $l$ cambiar\'ia
su valor a $m$ y, debido a que la diferencia entre $l$ y $r$ era mayor a 1, entonces
$l' = m < r$ y la condici\'on $p\;\cdot$ primos[$l'$] $\leq x$ y $p\;\cdot$ primos[$r$] $> x$ se sigue cumpliendo.
En el segundo caso tenemos $p\;\cdot$ primos[$m$] $> x$, aqu\'i $r' = m$ y cuando $r' > l$ la condici\'on se cumple de manera an\'aloga al caso anterior,
pero cuando $r' = l$, tenemos que en la siguiente iteraci\'on del bucle, al ya no distar $2$, saldr\'iamos del bucle
y necesariamente la respuesta se encuentra en nuestro extremo izquierdo $l$.
Ahora que ya sabemos que siempre terminamos obteniendo el \'ultimo elemento que cumple la condici\'on, analicemos el
orden de complejidad de este algoritmo. Sea $T: \BN \to \BN$ la funci\'on que cuenta la cantidad de operaciones
que realiza el bucle con $T(n) = 4 + T(\ceiling{\frac{n}{2}})$,
puesto que en el peor de los casos nos quedamos con la mitad m\'as grande;
no obstante, esto lo podemos expresar como $T(n) = O(1) + T(\frac{n}{2})$ seg\'un \cite{CLRS}
y utilizando inducci\'on sobre esta \'ultima conseguimos $T(n) = O(\log_2 n)$.
En el peor de los casos, $n = \pi(x)$, por lo que la complejidad total del algoritmo ser\'ia
$O(\log_2 \pi(x))$, el cual es a su vez $O(\log_2 x)$ por definici\'on.
\end{proof}

\begin{algorithm}[H]
\SetAlgoLined
\DontPrintSemicolon
\KwData{primos, suma\_log, $x$.}
\KwResult{$\sum_{pq \leq x} \ln p \ln q$.}
\Begin{
    $suma \leftarrow 0$\;
    \For{$pos_p \leftarrow 0$ \KwTo $|$primos$| - 1$}{
        $pos_q \leftarrow$ Buscar\'UltimaPosici\'on($pos_p$, $x$)\;
        \If{$pos_q = -1$}{
            \textbf{break}\;
        }
        $p \leftarrow$ primos$[pos_p]$\;
        $q \leftarrow$ primos$[pos_q]$\;
        $suma \leftarrow suma + \ln p \cdot ($suma\_log$[q] - $suma\_log$[p - 1])$\;
    }
    \textbf{return} $suma$\;
}
\caption{CalcularSuma\label{CS}}
\end{algorithm}

\begin{lemma}
Sea $x$ el n\'umero que representa la cota superior para el producto de dos n\'umeros primos
$p$ y $q$ en $\sum_{pq \leq x} \ln p \ln q$.
Si obtenemos el valor de esta sumatoria mediante la ejecuci\'on de CalcularSuma, 
el tiempo de ejecuci\'on es $O(x)$.
\end{lemma}

\begin{proof}
Tenemos los n\'umeros primos en el rango $[1 \dots x]$ en el contenedor ordenado $primos$,
entonces por definici\'on $\pi(x)=|primos| $.
Inicializar la suma en la l\'inea $2$ toma $O(1)$ en tiempo.
El bucle en las l\'ineas $3-11$ ser\'a ejecutado $O(\pi(x))$ veces.
La funci\'on Buscar\'UltimaPosici\'on en la l\'inea $4$ es llamada exactamente una vez para cada primo $p \in primos$ y
toma $O(\log_2 x)$ en tiempo de acuerdo con el lema 17, 
las dem\'as operaciones dentro del bucle toman $O(1)$ en tiempo.
De esta manera, el tiempo de ejecuci\'on del algoritmo es $O(\pi(x)\log_2 x)$.
Asimismo, Rosser y Barkley \cite[teorema 2 y corolario 1]{Chebyshev} probaron lo siguiente:
\begin{align}
\pi(x) \leq 1.25506\;\frac{x}{\ln x}. %%%%\;x > 1.
\end{align}
Utilizamos esto para tener un mejor estimado cual 
\begin{align}
    \pi(x)\log_2 x &\leq 1.25506\;\frac{x}{\ln x} \log_2 x\\
    &= 1.25506\;\log_2 e \frac{x}{\log_2 e \cdot \log_e x} \log_2 x\\
    &= 1.25506\;\log_2 e \frac{x}{\log_2 x} \log_2 x\\
    &= (1.25506\;\log_2 e) x\\
\end{align}
y concluimos que el tiempo de ejecuci\'on del algoritmo es $O(x)$.
\end{proof}

\begin{algorithm}[H]
\SetAlgoLined
\DontPrintSemicolon
\KwData{$x.$}
\KwResult{$\left|\frac{\sum_{p \leq x} \ln^2 p + \sum_{pq \leq x} \ln p \ln q - 2x\ln x}{x}\right|.$}
\Begin{
    CribaLineal($x$)\;
    \For{$i \leftarrow 1$ \KwTo $x$}{
        suma\_log$[i] \leftarrow 0$\;
        suma\_$\log^2[i] \leftarrow 0$\;
        \eIf{$es\_primo[i]$}{
            $\log[i] \leftarrow \ln i$\;
        }{
            $\log[i] \leftarrow 0$\;
        }
    }
    \For{$i \leftarrow 2$ \KwTo $x$}{
        suma\_log[$i] \leftarrow$ suma\_$\log[i - 1] + \log[i]$\;
        suma\_$\log^2[i] \leftarrow$ suma\_$\log^2[i - 1] + (\log[i])^2$\;
    }
    \textbf{return} $\frac{|\text{suma}\_\log^2[x] + \text{CalcularSuma}(x) - 2x\ln x|}{x}$\;
}
\caption{EstimarConstante}
\end{algorithm}

\begin{theorem}
Con $x$ el n\'umero natural para el cual se quiere determinar
$$\frac{|\sum_{p \leq x} \ln^2 p + \sum_{pq \leq x} \ln p \ln q - 2x\ln x|}{x}$$
mediante la ejecuci\'on de EstimarConstante
resulta que el tiempo de ejecuci\'on es $O(x)$.
\end{theorem}

\begin{proof}
\end{proof}

\subsection{Programa en C++ y estimados}

Sea $t$ la cantidad de casos de prueba y $n$ el m\'aximo valor que puede tomar $x$ en la expresi\'on que analizaremos. 
El siguiente programa en C++ determina el valor de 
$$\frac{|\sum_{p \leq x} \ln^2 p + \sum_{pq \leq x} \ln p \ln q - 2x\ln x|}{x}$$
para cada caso de prueba.
En particular, usaremos $t = 28$ y $n = 3 \cdot 10^7$.
La complejidad asint\'otica en tiempo del programa es $O(tn)$, la cual se ve reflejada en un tiempo de ejecuci\'on
de tan solo tres segundos.

\begin{center}
    \texttt{real	0m3,123s}\\
    \texttt{user	0m2,675s}\\
    \texttt{sys	0m0,436s}.
\end{center}

% \cppfile{formula_selberg.cpp}

\begin{table}
\centering
\caption{Resultado del programa en cada uno de los 28 casos de prueba.}
\begin{tabular}{@{} l *{5}{S[table-format=-1.7]} @{}} 
\toprule
{$x$} & 
{$\sum_{p \leq x} \ln^2 p + \sum_{pq \leq x} \ln p \ln q - 2x\ln x$} & 
{$\frac{|\sum_{p \leq x} \ln^2 p + \sum_{pq \leq x} \ln p \ln q - 2x\ln x|}{x}$}\\ % center-set header entries
\midrule
10 & -34.4229638465 & 3.4422963847\\
100 & -519.2686545658 & 5.1926865457\\
1000 & -6317.3110617078 & 6.3173110617\\
10000 & -74463.8721010727 & 7.4463872101\\
100000 & -859318.2559356594 & 8.5931825594\\
1000000 & -9747133.5703212193 & 9.7471335703\\
1500000 & -14918429.3651946987 & 9.9456195768\\
2000000 & -20177763.7803012519 & 10.0888818902\\
2500000 & -25505439.7770474999 & 10.2021759108\\
3000000 & -30875441.5873458827 & 10.2918138624\\
3500000 & -36291518.9878187147 & 10.3690054251\\
4000000 & -41746678.7374733434 & 10.4366696844\\
4500000 & -47221448.8244719136 & 10.4936552943\\
5000000 & -52725446.2863963772 & 10.5450892573\\
5500000 & -58263339.7575164592 & 10.5933345014\\
6000000 & -63830467.8915757891 & 10.6384113153\\
6500000 & -69414402.9962517989 & 10.6791389225\\
7000000 & -74998328.6200477667 & 10.7140469457\\
7500000 & -80619769.8168214446 & 10.7493026422\\
8000000 & -86252298.0080809856 & 10.7815372510\\
8500000 & -91907189.6865512790 & 10.8126105514\\
9000000 & -97554179.0078311940 & 10.8393532231\\
9500000 & -103244044.9516971762 & 10.8677942054\\
10000000 & -108942869.8283277971 & 10.8942869828\\
15000000 & -166436611.9307800680 & 11.0957741287\\
20000000 & -224778414.1259130784 & 11.2389207063\\
25000000 & -283766370.6499844969 & 11.3506548260\\
30000000 & -343248619.2823745428 & 11.4416206427\\
\bottomrule
\end{tabular}
\end{table}
